{
  "rows": 3022,
  "columns": [
    "streetAddress",
    "suburb",
    "state",
    "postcode",
    "propertyType",
    "bed",
    "bath",
    "car",
    "landSizeM2",
    "floorSizeM2",
    "yearBuilt",
    "salePrice",
    "saleDate",
    "saleType",
    "agency",
    "landUse",
    "developmentZone",
    "parcelDetails",
    "ownerType",
    "openInRpdata",
    "sourceFile",
    "agencyBrand",
    "saleYear",
    "saleMonth",
    "saleYearMonth",
    "street",
    "month_id",
    "saleMonth_sin",
    "saleMonth_cos",
    "property_type_tag",
    "suburb_price_median_3m",
    "suburb_txn_count_3m",
    "suburb_price_median_6m",
    "suburb_txn_count_6m",
    "suburb_price_median_12m",
    "suburb_txn_count_12m",
    "ratio_land_per_bed",
    "ratio_floor_per_bed",
    "ratio_car_per_bed",
    "ratio_bed_bath",
    "price_per_sqm_land",
    "price_per_sqm_floor",
    "year",
    "asx200_close",
    "asx200_yoy",
    "cpi_index_dec",
    "cpi_yoy_dec",
    "cpi_index_avg",
    "cpi_yoy_avg",
    "cash_rate_avg",
    "cash_rate_eoy",
    "cash_rate_change_avg",
    "cash_rate_change_eoy",
    "suburb_price_median_current",
    "street_price_median_current",
    "rel_price_suburb",
    "rel_price_street",
    "propertyAge",
    "propertyAgeBand",
    "bed_bucket",
    "bath_bucket",
    "land_bucket",
    "floor_bucket",
    "current_price_median",
    "current_price_mean",
    "transaction_count",
    "avg_land_size",
    "avg_floor_size",
    "price_future_6m",
    "price_future_6m_delta",
    "price_future_6m_diff",
    "price_future_12m",
    "price_future_12m_delta",
    "price_future_12m_diff",
    "price_future_12m_smooth",
    "price_future_12m_smooth_delta",
    "price_future_12m_smooth_diff"
  ],
  "numeric_columns": [
    "postcode",
    "bed",
    "bath",
    "car",
    "landSizeM2",
    "floorSizeM2",
    "yearBuilt",
    "salePrice",
    "saleYear",
    "saleMonth",
    "saleYearMonth",
    "month_id",
    "saleMonth_sin",
    "saleMonth_cos",
    "suburb_price_median_3m",
    "suburb_txn_count_3m",
    "suburb_price_median_6m",
    "suburb_txn_count_6m",
    "suburb_price_median_12m",
    "suburb_txn_count_12m",
    "ratio_land_per_bed",
    "ratio_floor_per_bed",
    "ratio_car_per_bed",
    "ratio_bed_bath",
    "price_per_sqm_land",
    "price_per_sqm_floor",
    "year",
    "asx200_close",
    "asx200_yoy",
    "cpi_index_dec",
    "cpi_yoy_dec",
    "cpi_index_avg",
    "cpi_yoy_avg",
    "cash_rate_avg",
    "cash_rate_eoy",
    "cash_rate_change_avg",
    "cash_rate_change_eoy",
    "suburb_price_median_current",
    "street_price_median_current",
    "rel_price_suburb",
    "rel_price_street",
    "propertyAge",
    "current_price_median",
    "current_price_mean",
    "transaction_count",
    "avg_land_size",
    "avg_floor_size",
    "price_future_6m",
    "price_future_6m_delta",
    "price_future_6m_diff",
    "price_future_12m",
    "price_future_12m_delta",
    "price_future_12m_diff",
    "price_future_12m_smooth",
    "price_future_12m_smooth_delta",
    "price_future_12m_smooth_diff"
  ],
  "categorical_columns": [
    "streetAddress",
    "suburb",
    "state",
    "propertyType",
    "saleType",
    "agency",
    "landUse",
    "developmentZone",
    "parcelDetails",
    "ownerType",
    "openInRpdata",
    "sourceFile",
    "agencyBrand",
    "street",
    "property_type_tag",
    "propertyAgeBand",
    "bed_bucket",
    "bath_bucket",
    "land_bucket",
    "floor_bucket"
  ],
  "sources": [],
  "config": {
    "preprocess": {
      "clean": {
        "config_path": "/mnt/g/dev/property_analyst/config/pp_clean.yml",
        "output_path": "/mnt/g/dev/property_analyst/data/preprocess/cleaned.parquet",
        "dropped_rows_path": "/mnt/g/dev/property_analyst/data/preprocess/dropped_rows.parquet"
      },
      "derivation": {
        "config_path": "/mnt/g/dev/property_analyst/config/pp_derive.yml",
        "output_path": "/mnt/g/dev/property_analyst/data/preprocess/derived.parquet",
        "metadata_path": "/mnt/g/dev/property_analyst/data/preprocess/metadata.json",
        "segment_output_path": "/mnt/g/dev/property_analyst/data/preprocess/segments.parquet",
        "detailed_output_path": "/mnt/g/dev/property_analyst/data/preprocess/derived_detailed.parquet"
      },
      "options": {
        "verbose": true
      },
      "source_path": "/mnt/g/dev/property_analyst/config/preprocessing.yml"
    },
    "cleaning": {
      "data_source": {
        "path": "data/raw",
        "pattern": "*.csv",
        "encoding": "utf-8-sig"
      },
      "min_non_null_fraction": 0.35,
      "special_to_ascii": {
        "Â²": "2"
      },
      "normalise_text_columns": [
        "streetAddress",
        "propertyType",
        "agency",
        "landUse",
        "developmentZone"
      ],
      "numeric_candidates": [
        "bed",
        "bath",
        "car",
        "landSizeM2",
        "floorSizeM2",
        "yearBuilt",
        "salePrice",
        "postcode"
      ],
      "bucketing_rules": null,
      "required_columns": [
        "salePrice",
        "bed",
        "bath"
      ],
      "category_mappings": {
        "propertyType": {
          "source": "propertyType",
          "default": "Unknown",
          "preserve_unmatched": false,
          "mode": "contains",
          "rules": {
            "House": [
              "house",
              "townhouse",
              "dwelling"
            ],
            "Unit": [
              "unit",
              "villa",
              "duplex"
            ],
            "Apartment": [
              "flat",
              "studio"
            ]
          }
        },
        "agencyBrand": {
          "source": "agency",
          "default": "Other",
          "mode": "contains",
          "rules": {
            "Noel Jones": [
              "NOEL JONES"
            ],
            "Barry Plant": [
              "BARRY PLANT"
            ],
            "Jellis Craig": [
              "JELLIS CRAIG"
            ],
            "Ray White": [
              "RAY WHITE"
            ],
            "Harcourts": [
              "HARCOURTS"
            ],
            "Woodards": [
              "WOODARDS"
            ],
            "Biggin & Scott": [
              "BIGGIN & SCOTT"
            ],
            "Fletchers": [
              "FLETCHERS"
            ],
            "Unknown": [
              "UNKNOWN"
            ],
            "Other": [
              "OTHER"
            ]
          }
        },
        "developmentZone": {
          "RGZ1": [
            "residential growth zone - schedule 1",
            "residential growth zone schedule 1",
            "rgz1"
          ],
          "RGZ2": [
            "residential growth zone - schedule 2",
            "residential growth zone schedule 2",
            "rgz2"
          ],
          "RGZ3": [
            "residential growth zone - schedule 3",
            "residential growth zone schedule 3",
            "rgz3"
          ],
          "NRZ1": [
            "neighbourhood residential zone - schedule 1",
            "neighbourhood residential zone schedule 1",
            "nrz1"
          ],
          "NRZ2": [
            "neighbourhood residential zone - schedule 2",
            "neighbourhood residential zone schedule 2",
            "nrz2"
          ],
          "NRZ3": [
            "neighbourhood residential zone - schedule 3",
            "neighbourhood residential zone schedule 3",
            "nrz3"
          ],
          "NRZ4": [
            "neighbourhood residential zone - schedule 4",
            "neighbourhood residential zone schedule 4",
            "nrz4"
          ],
          "GRZ1": [
            "general residential zone - schedule 1",
            "general residential zone schedule 1",
            "grz1"
          ],
          "GRZ2": [
            "general residential zone - schedule 2",
            "general residential zone schedule 2",
            "grz2"
          ],
          "GRZ3": [
            "general residential zone - schedule 3",
            "general residential zone schedule 3",
            "grz3"
          ],
          "C1Z": [
            "commercial 1 zone",
            "c1z"
          ],
          "C2Z": [
            "commercial 2 zone",
            "c2z"
          ],
          "MUZ": [
            "mixed use zone",
            "muz"
          ],
          "IN1Z": [
            "industrial 1 zone",
            "in1z"
          ],
          "IN2Z": [
            "industrial 2 zone",
            "in2z"
          ],
          "IN3Z": [
            "industrial 3 zone",
            "in3z"
          ],
          "LDRZ": [
            "low density residential zone",
            "ldrz"
          ],
          "TZ": [
            "township zone",
            "tz"
          ],
          "UGZ1": [
            "urban growth zone - schedule 1",
            "urban growth zone schedule 1",
            "ugz1"
          ],
          "UGZ2": [
            "urban growth zone - schedule 2",
            "urban growth zone schedule 2",
            "ugz2"
          ],
          "UGZ3": [
            "urban growth zone - schedule 3",
            "urban growth zone schedule 3",
            "ugz3"
          ]
        }
      },
      "dropped_rows_path": "/mnt/g/dev/property_analyst/data/preprocess/dropped_rows.parquet"
    },
    "derivation": {
      "spec_version": 1,
      "settings": {
        "on_missing_source": "error",
        "output_conflict": "error",
        "default_fillna": null,
        "datasets": {
          "macro_au_annual": "data/macro/macro_au_annual.csv"
        }
      },
      "steps": [
        {
          "id": "sale_date_parts",
          "type": "simple",
          "enabled": true,
          "method": "date_parts",
          "config": {
            "source": "saleDate",
            "year_output": "saleYear",
            "month_output": "saleMonth",
            "year_month_output": "saleYearMonth"
          }
        },
        {
          "id": "street",
          "type": "simple",
          "enabled": true,
          "source": "streetAddress",
          "output": "street",
          "method": "extract_street",
          "config": {
            "unknown_value": "Unknown"
          }
        },
        {
          "id": "month_index",
          "type": "simple",
          "enabled": true,
          "source": "saleYearMonth",
          "output": "month_id",
          "method": "to_month_index",
          "config": {
            "offset": 0
          }
        },
        {
          "id": "month_cyclical",
          "type": "simple",
          "enabled": true,
          "source": "saleMonth",
          "output": [
            "saleMonth_sin",
            "saleMonth_cos"
          ],
          "method": "cyclical_encode",
          "config": {
            "period": 12
          }
        },
        {
          "id": "map_property_type_to_tag",
          "type": "simple",
          "enabled": true,
          "source": "propertyType",
          "output": "property_type_tag",
          "method": "map_values",
          "config": {
            "mapping": {
              "HOUSE": "house",
              "TOWNHOUSE": "house"
            },
            "default": "other"
          }
        },
        {
          "id": "suburb_time_agg_3m",
          "type": "time_aggregate",
          "enabled": true,
          "group_by": [
            "suburb",
            "property_type_tag"
          ],
          "time_col": "saleYearMonth",
          "target": "salePrice",
          "window": {
            "past": 3,
            "future": 0,
            "unit": "months"
          },
          "outputs": {
            "median": "suburb_price_median_3m",
            "count": "suburb_txn_count_3m"
          }
        },
        {
          "id": "suburb_time_agg_6m",
          "type": "time_aggregate",
          "enabled": true,
          "group_by": [
            "suburb",
            "property_type_tag"
          ],
          "time_col": "saleYearMonth",
          "target": "salePrice",
          "window": {
            "past": 6,
            "future": 0,
            "unit": "months"
          },
          "outputs": {
            "median": "suburb_price_median_6m",
            "count": "suburb_txn_count_6m"
          }
        },
        {
          "id": "suburb_time_agg_12m",
          "type": "time_aggregate",
          "enabled": true,
          "group_by": [
            "suburb",
            "property_type_tag"
          ],
          "time_col": "saleYearMonth",
          "target": "salePrice",
          "window": {
            "past": 12,
            "future": 0,
            "unit": "months"
          },
          "outputs": {
            "median": "suburb_price_median_12m",
            "count": "suburb_txn_count_12m"
          }
        },
        {
          "id": "ratio_land_per_bed",
          "type": "simple",
          "enabled": true,
          "output": "ratio_land_per_bed",
          "method": "expr",
          "config": {
            "expr": "landSizeM2 / nullif(bed + 1, 0)"
          }
        },
        {
          "id": "ratio_floor_per_bed",
          "type": "simple",
          "enabled": true,
          "output": "ratio_floor_per_bed",
          "method": "expr",
          "config": {
            "expr": "floorSizeM2 / nullif(bed + 1, 0)"
          }
        },
        {
          "id": "ratio_car_per_bed",
          "type": "simple",
          "enabled": true,
          "output": "ratio_car_per_bed",
          "method": "expr",
          "config": {
            "expr": "car / nullif(bed + 1, 0)"
          }
        },
        {
          "id": "ratio_bed_bath",
          "type": "simple",
          "enabled": true,
          "output": "ratio_bed_bath",
          "method": "expr",
          "config": {
            "expr": "bed / nullif(bath + 1, 0)"
          }
        },
        {
          "id": "price_per_area_land",
          "type": "simple",
          "enabled": true,
          "output": "price_per_sqm_land",
          "method": "expr",
          "config": {
            "expr": "clip(salePrice / nullif(landSizeM2, 0), 0, None)"
          }
        },
        {
          "id": "price_per_area_floor",
          "type": "simple",
          "enabled": true,
          "output": "price_per_sqm_floor",
          "method": "expr",
          "config": {
            "expr": "clip(salePrice / nullif(floorSizeM2, 0), 0, None)"
          }
        },
        {
          "id": "macro_join",
          "type": "join",
          "enabled": true,
          "right": "macro_au_annual",
          "how": "left",
          "on": [
            {
              "left": "saleYear",
              "right": "year"
            }
          ],
          "select": [
            "asx200_close",
            "asx200_yoy",
            "cpi_index_dec",
            "cpi_yoy_dec",
            "cpi_index_avg",
            "cpi_yoy_avg",
            "cash_rate_avg",
            "cash_rate_eoy",
            "cash_rate_change_avg",
            "cash_rate_change_eoy"
          ]
        },
        {
          "id": "suburb_price_current",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "salePrice",
          "outputs": {
            "median": "suburb_price_median_current"
          }
        },
        {
          "id": "region_price_current",
          "type": "aggregate",
          "enabled": false,
          "group_by": [
            "region"
          ],
          "target": "salePrice",
          "outputs": {
            "median": "region_price_median_current"
          }
        },
        {
          "id": "street_price_current",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb",
            "street"
          ],
          "target": "salePrice",
          "outputs": {
            "median": "street_price_median_current"
          },
          "config": {
            "min_count": 5
          }
        },
        {
          "id": "rel_price_suburb",
          "type": "simple",
          "enabled": true,
          "output": "rel_price_suburb",
          "method": "expr",
          "config": {
            "expr": "(salePrice - suburb_price_median_current) / nullif(suburb_price_median_current, 0)"
          }
        },
        {
          "id": "rel_price_region",
          "type": "simple",
          "enabled": false,
          "output": "rel_price_region",
          "method": "expr",
          "config": {
            "expr": "(salePrice - region_price_median_current) / nullif(region_price_median_current, 0)"
          }
        },
        {
          "id": "rel_price_street",
          "type": "simple",
          "enabled": true,
          "output": "rel_price_street",
          "method": "expr",
          "config": {
            "expr": "(salePrice - street_price_median_current) / nullif(street_price_median_current, 0)"
          }
        },
        {
          "id": "property_age",
          "type": "simple",
          "enabled": true,
          "output": "propertyAge",
          "method": "expr",
          "config": {
            "expr": "max(saleYear - yearBuilt, 0)"
          }
        },
        {
          "id": "age_bands",
          "type": "bin",
          "enabled": true,
          "source": "propertyAge",
          "output": "propertyAgeBand",
          "method": "fixed",
          "config": {
            "edges": [
              5,
              20
            ],
            "labels": [
              "0â5",
              "6â20",
              "21+"
            ]
          }
        },
        {
          "id": "bed_bucket",
          "type": "bin",
          "enabled": true,
          "source": "bed",
          "output": "bed_bucket",
          "method": "fixed",
          "config": {
            "edges": [
              2,
              3,
              4
            ],
            "labels": [
              "<=2",
              "3",
              "4",
              "5+"
            ],
            "fill_value": "Unknown"
          }
        },
        {
          "id": "bath_bucket",
          "type": "bin",
          "enabled": true,
          "source": "bath",
          "output": "bath_bucket",
          "method": "fixed",
          "config": {
            "edges": [
              1,
              2,
              3
            ],
            "labels": [
              "0-1",
              "2",
              "3",
              "4+"
            ],
            "fill_value": "Unknown"
          }
        },
        {
          "id": "land_bucket",
          "type": "bin",
          "enabled": true,
          "source": "landSizeM2",
          "output": "land_bucket",
          "method": "fixed",
          "config": {
            "edges": [
              400,
              700
            ],
            "labels": [
              "<=400",
              "401-700",
              "700+"
            ],
            "fill_value": "Unknown"
          }
        },
        {
          "id": "floor_bucket",
          "type": "bin",
          "enabled": true,
          "source": "floorSizeM2",
          "output": "floor_bucket",
          "method": "fixed",
          "config": {
            "edges": [
              150,
              220
            ],
            "labels": [
              "<=150",
              "151-220",
              "220+"
            ],
            "fill_value": "Unknown"
          }
        },
        {
          "id": "current_price_median",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "salePrice",
          "outputs": {
            "median": "current_price_median"
          }
        },
        {
          "id": "current_price_mean",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "salePrice",
          "outputs": {
            "mean": "current_price_mean"
          }
        },
        {
          "id": "transaction_count",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "salePrice",
          "outputs": {
            "count": "transaction_count"
          }
        },
        {
          "id": "avg_land_size",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "landSizeM2",
          "outputs": {
            "mean": "avg_land_size"
          }
        },
        {
          "id": "avg_floor_size",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "floorSizeM2",
          "outputs": {
            "mean": "avg_floor_size"
          }
        },
        {
          "id": "ratio_land_per_bed_mean",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "ratio_land_per_bed",
          "outputs": {
            "mean": "ratio_land_per_bed"
          }
        },
        {
          "id": "ratio_floor_per_bed_mean",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "ratio_floor_per_bed",
          "outputs": {
            "mean": "ratio_floor_per_bed"
          }
        },
        {
          "id": "ratio_car_per_bed_mean",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "ratio_car_per_bed",
          "outputs": {
            "mean": "ratio_car_per_bed"
          }
        },
        {
          "id": "ratio_bed_bath_mean",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "ratio_bed_bath",
          "outputs": {
            "mean": "ratio_bed_bath"
          }
        },
        {
          "id": "price_per_sqm_land_median",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "price_per_sqm_land",
          "outputs": {
            "median": "price_per_sqm_land"
          }
        },
        {
          "id": "price_per_sqm_floor_median",
          "type": "aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "target": "price_per_sqm_floor",
          "outputs": {
            "median": "price_per_sqm_floor"
          }
        },
        {
          "id": "price_future_6m",
          "type": "time_aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "time_col": "month_id",
          "target": "salePrice",
          "window": {
            "past": 0,
            "future": 6,
            "unit": "months"
          },
          "outputs": {
            "median": "price_future_6m"
          }
        },
        {
          "id": "price_future_6m_delta",
          "type": "simple",
          "enabled": true,
          "output": "price_future_6m_delta",
          "method": "expr",
          "config": {
            "expr": "(price_future_6m - current_price_median) / nullif(current_price_median, 0)"
          }
        },
        {
          "id": "price_future_6m_diff",
          "type": "simple",
          "enabled": true,
          "output": "price_future_6m_diff",
          "method": "expr",
          "config": {
            "expr": "price_future_6m - current_price_median"
          }
        },
        {
          "id": "price_future_12m",
          "type": "time_aggregate",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "time_col": "month_id",
          "target": "salePrice",
          "window": {
            "past": 0,
            "future": 12,
            "unit": "months"
          },
          "outputs": {
            "median": "price_future_12m"
          }
        },
        {
          "id": "price_future_12m_delta",
          "type": "simple",
          "enabled": true,
          "output": "price_future_12m_delta",
          "method": "expr",
          "config": {
            "expr": "(price_future_12m - current_price_median) / nullif(current_price_median, 0)"
          }
        },
        {
          "id": "price_future_12m_diff",
          "type": "simple",
          "enabled": true,
          "output": "price_future_12m_diff",
          "method": "expr",
          "config": {
            "expr": "price_future_12m - current_price_median"
          }
        },
        {
          "id": "price_future_12m_smooth",
          "type": "rolling",
          "enabled": true,
          "group_by": [
            "suburb"
          ],
          "sort_by": "month_id",
          "target": "price_future_12m",
          "window": 12,
          "outputs": {
            "mean": "price_future_12m_smooth"
          },
          "config": {
            "min_periods": 6,
            "center": false
          }
        },
        {
          "id": "price_future_12m_smooth_delta",
          "type": "simple",
          "enabled": true,
          "output": "price_future_12m_smooth_delta",
          "method": "expr",
          "config": {
            "expr": "(price_future_12m_smooth - current_price_median) / nullif(current_price_median, 0)"
          }
        },
        {
          "id": "price_future_12m_smooth_diff",
          "type": "simple",
          "enabled": true,
          "output": "price_future_12m_smooth_diff",
          "method": "expr",
          "config": {
            "expr": "price_future_12m_smooth - current_price_median"
          }
        }
      ]
    }
  }
}